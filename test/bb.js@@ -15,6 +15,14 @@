import '../../../main.js';
import { readFileSync } from 'fs';

const clean = false
if (ScriptApp.isFake) ScriptApp.__behavior.sandboxMode = true;

const bb = JSON.parse(readFileSync('buildingblocks.json', 'utf8'))


const form = FormApp.create('testing bb').setTitle('title bb').setDescription('description bb')
const addGridItem = ({ form, item }) => {
  const gridItem = form.addGridItem()
  gridItem.setTitle(item.title || item.desription).setRequired(item.required)
  const rows = item.questions.map(f => f.text)
  gridItem.setRows(rows)
  const columns = Reflect.ownKeys(item.labels)
  gridItem.setColumns(columns)
  return gridItem
}
const addScaleItem = ({ form, item }) => {
  const scaleItem = form.addScaleItem()
  scaleItem.setTitle(item.title || item.desription).setRequired(item.required)
  const labels = Object.values(item.labels)
  scaleItem.setBounds(parseInt(Object.keys(item.labels)[0]), parseInt(Object.keys(item.labels)[labels.length - 1]))
    .setLabels(labels[0], labels[labels.length - 1])
  return scaleItem
}
const addSection = ({ form, section, description }) => {
  console.log (section, description)
  const item = form.addSectionHeaderItem()
  item.setTitle(section.title).setHelpText(description)
  return item
}

const blocks = bb.map(item => {
  const { block, type, sections, description } = item
  return sections.map(section => {
    // add a section headeritem
    addSection({ form, section, description })
    return section.items.map(item => {
      // add the questions
      switch (item.questionType.toLowerCase()) {
        case "multiple choice grid":
          return addGridItem({ form, item })
        case "linear scale":
          return addScaleItem({ form, item })
        default:
          throw new Error(`invalid question type ${item.questionType}`)
      }
    })
  })



})

if (!clean) {
  console.log('Form URL (for viewing/sharing): ' + form.getPublishedUrl());
  console.log('Form Editor URL (for editing): ' + form.getEditUrl());
} else {
  if (ScriptApp.isFake) ScriptApp.__behavior.trash();
}